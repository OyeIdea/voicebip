# SIP Gateway Service

## Purpose

The SIP Gateway Service is a core component of the RevoVoiceAI Voice Gateway Layer. It acts as the primary interface for integrating with traditional telephony systems and Voice over IP (VoIP) networks using the Session Initiation Protocol (SIP). Its main responsibilities include handling SIP signaling, managing call sessions, and facilitating Real-time Transport Protocol (RTP) media streams.

## Core Functions (Conceptual)

*   **SIP Signaling**: Listens for and processes incoming SIP messages (INVITE, ACK, BYE, REGISTER, OPTIONS, etc.) from SIP clients or telephony providers.
*   **Call Management**: Establishes, maintains, and terminates call sessions based on SIP signaling.
*   **RTP Session Management**: Sets up and tears down RTP sessions for the transmission and reception of audio media. This involves SDP (Session Description Protocol) negotiation.
*   **Registration**: Can act as a SIP registrar for SIP endpoints or register with an upstream SIP provider.
*   **Routing**: Determines how incoming calls should be routed to the appropriate internal services (e.g., the Real-Time Processing Engine for AI processing).
*   **Interfacing with Telephony Providers**: Connects to external SIP trunks or telephony carriers.

## Components

*   `service.py`: Contains the main `SIPGatewayService` class. This class is responsible for initializing the SIP stack, handling listeners, processing SIP messages (delegating to specific handlers), and managing RTP sessions.
*   `config.py`: (Placeholder) Intended for service-specific configurations, such as listen IP addresses and ports, SIP transport protocols (UDP/TCP/TLS), upstream SIP provider details, supported codecs, and RTP port ranges.
*   `handlers/`: (Placeholder directory) Intended to house more detailed logic for handling specific SIP methods (e.g., `invite_handler.py`, `bye_handler.py`).
*   `__init__.py`: Makes the directory a Python package.

## Interaction with Other System Components

The SIP Gateway Service is a critical entry and exit point for voice:

1.  **Incoming Call**:
    *   An incoming SIP INVITE is received from a telephony provider or SIP endpoint.
    *   The `SIPGatewayService` parses the INVITE and negotiates SDP for an RTP media stream.
    *   It establishes an RTP session to receive audio from the caller.
    *   The gateway then signals the `StreamingDataManager` (in the Real-Time Processing Engine) about this new audio stream, providing it with the necessary information to consume the RTP data.
    *   The Real-Time Processing Engine then handles STT, NLU, DM, etc.
2.  **Outgoing Call / Response**:
    *   When the system needs to send audio back to the caller (e.g., a TTS response), the `SIPGatewayService` receives instructions or text from the Dialogue Management system (potentially via an orchestrator).
    *   If it's a TTS response, the audio is generated by the `TextToSpeechService` and streamed via RTP through the session managed by the SIP Gateway.
    *   The SIP Gateway handles the necessary SIP signaling to maintain or terminate the call.

This service will eventually integrate with robust SIP stacks or libraries (e.g., PJSIP, Kamailio, FreeSWITCH, or Python libraries like `aiosip`, `sippy`) to handle the complexities of SIP and RTP.
